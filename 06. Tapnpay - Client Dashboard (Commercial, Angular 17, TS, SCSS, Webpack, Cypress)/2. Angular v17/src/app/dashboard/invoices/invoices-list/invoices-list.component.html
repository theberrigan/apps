<!-- Page Header -->
<ng-container [ngSwitch]="viewportBreakpoint">
    <page-panel *ngSwitchCase="'desktop'">
        <h1 class="page-panel__header" [innerHTML]="'invoices.invoices_list.page_header' | translate"></h1>
    </page-panel>
    <app-bar *ngSwitchDefault></app-bar>
</ng-container>

<!-- Page Content -->
<div class="invoices-list__content" [ngSwitch]="listState">
    <div class="invoices-list__loading" *ngSwitchCase="'loading'">
        <loader></loader>
    </div>
    <div class="invoices-list__message" *ngSwitchCase="'empty'">
        <img src="assets/images/history-invoice-and-transactions.png" alt="No Invoices" style="max-width: 120px; display: block; margin: 0 auto 16px auto;" />
        {{ 'invoices.invoices_list.no_invoices' | translate }}
    </div>
    <div class="invoices-list__message invoices-list__message_error" *ngSwitchCase="'error'">
        {{ 'invoices.invoices_list.loading_error' | translate }}
    </div>

    <ng-container *ngSwitchCase="'list'">
        <ng-container *ngIf="surchargeSum">
            <app-alert [surchargeSum]="surchargeSum"></app-alert>
        </ng-container>
        <div class="invoice-card invoice-card--header justify-center">
            <div class="invoice-field invoice-checkbox">
                <checkbox-static [isChecked]="isAllInvoicesSelectedToPay"
                                 [isDisabled]="isSubmitting"
                                 (click)="onCheckAllInvoices()"></checkbox-static>
            </div>
            <div class="mobile-column">
                <div class="invoice-field invoices-name">
                    {{ 'invoices.invoices_list.invoice_no_th' | translate }}
                </div>
                <div class="invoice-field invoice-transactions">
                    {{ 'invoices.invoices_list.transactions_th' | translate }}
                </div>

                <div class="invoice-field invoice-date">
                    {{ 'invoices.invoices_list.date_th' | translate }}
                </div>
            </div>
            <div class="invoice-field invoice-amount">
                {{ 'invoices.invoices_list.total_amount_th' | translate }}
            </div>
        </div>

        <ng-container *ngFor="let invoice of allInvoices.regular; trackBy: trackByFn">

            <div class="invoice-card" (click)="onItemClick(invoice, $event)">
                <div class="invoice-field invoice-checkbox" (click)="onCheckboxCellClick(invoice, $event)">
                    <checkbox-static [isChecked]="invoice.isSelectedToPay"
                                     [isDisabled]="isSubmitting"></checkbox-static>
                </div>
                <div class="mobile-column">
                    <div class="invoice-field invoices-name">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.invoice_no_th' | translate }}
                    </span>
                        {{ invoice.name }}
                    </div>
                    <div class="invoice-field invoice-transactions">
                    <span class="invoice-field__title">
                         {{ 'invoices.invoices_list.transactions_th' | translate }}
                    </span>
                        {{ invoice.transactionCount }}
                    </div>

                    <div class="invoice-field invoice-date">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.date_th' | translate }}
                    </span>
                        {{ invoice.createTs | datetime : 'display.date' }}
                        <div class="invoice-date__due-in"
                             *ngIf="invoice.showTimeLeft"
                             [class.invoice-date__due-in--low]="invoice.isLowTimeLeft">
                            <div *ngIf="!invoice.isPassedDue">
                                {{ 'invoices.invoices_list.due_in' | translate : {time: invoice.hoursLeft} }}
                            </div>
                            <div *ngIf="invoice.isPassedDue">
                                {{ 'invoices.invoices_list.past_due' | translate }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="invoice-field invoice-amount">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.total_amount_th' | translate }}
                    </span>
                    {{ invoice.amount | currencyFormat }}
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="allInvoices.subscription && allInvoices.subscription.length > 0">
            <h3 class="d-block page-subtitle mt-32 mb-16">
                {{ 'invoices.invoices_list.subscription_list_title' | translate }}
            </h3>
        </ng-container>
        <ng-container *ngFor="let invoice of allInvoices.subscription trackBy: trackByFn">
            <div class="invoice-card" routerLink="/dashboard/profile/subscription">
                <div class="invoice-field invoice-checkbox" (click)="onCheckboxCellClick(invoice, $event)">
                    <checkbox-static [isChecked]="invoice.isSelectedToPay"
                                     [isDisabled]="isSubmitting"></checkbox-static>
                </div>
                <div class="mobile-column">
                    <div class="invoice-field invoices-name">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.invoice_no_th' | translate }}
                    </span>
                        {{ invoice.name }}
                    </div>
                    <div class="invoice-field invoice-transactions">
                    <span class="invoice-field__title">
                         {{ 'invoices.invoices_list.transactions_th' | translate }}
                    </span>
                        {{ invoice.transactionCount }}
                    </div>

                    <div class="invoice-field invoice-date">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.date_th' | translate }}
                    </span>
                        {{ invoice.createTs | datetime : 'display.date' }}
                        <div class="invoice-date__due-in"
                             *ngIf="invoice.showTimeLeft"
                             [class.invoice-date__due-in--low]="invoice.isLowTimeLeft">
                            <div *ngIf="!invoice.isPassedDue">
                                {{ 'invoices.invoices_list.due_in' | translate : {time: invoice.hoursLeft} }}
                            </div>
                            <div *ngIf="invoice.isPassedDue">
                                {{ 'invoices.invoices_list.past_due' | translate }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="invoice-field invoice-amount">
                    <span class="invoice-field__title">
                        {{ 'invoices.invoices_list.total_amount_th' | translate }}
                    </span>
                    {{ invoice.amount | currencyFormat }}
                </div>
            </div>
        </ng-container>

    </ng-container>
</div>

<invoice-payment
    #paymentComponent
    [invoiceItems]="invoiceItemsToPay"
    [totalAmount]="checkedInvoiceAmountSum"
    (paymentBegin)="onPaymentBegin()"
    (paymentSuccess)="onPaymentSuccess()"
    (paymentCancel)="onPaymentCancel()"
    (paymentChecked)="onPaymentChecked()"
></invoice-payment>

<!-- Context Panels -->
<context-panel *ngIf="isActionsVisible">
    <app-pay-panel
        [isLoading]="isSubmitting"
        [checkedInvoiceAmountSum]="checkedInvoiceAmountSum"
        [surchargeSum]="surchargeSum"
        (makePayment)="onMakePayment($event)"
        (showDetails)="onShowDetails()"></app-pay-panel>
</context-panel>
