<ng-template #listOptionsTpl>
    <ng-container *ngIf="state">
        <div class="action-panel__item filters__filter">
            <label class="filters__filter-label">{{ 'clients.list.order_by' | translate }}</label>
            <sort-select class="filters__filter-input" [(ngModel)]="state.sort" [options]="sortOptions" (ngModelChange)="onOrderChange()"></sort-select>
        </div>
        <div class="action-panel__item filters__filter">
            <label class="filters__filter-label">{{ 'clients.list.limit' | translate }}</label>
            <select class="select select_regular filters__filter-input" [(ngModel)]="state.pagination.size" (ngModelChange)="onLimitChange()">
                <option *ngFor="let sizeOption of sizeOptions" [ngValue]="sizeOption">{{ sizeOption }}</option>
            </select>
        </div>
    </ng-container>
</ng-template>

<action-panel>
    <div class="action-panel__primary">
        <h1 class="action-panel__header">{{ 'clients.list.page_header' | translate }}</h1>
        <button class="button button_regular button_green" routerLink="/dashboard/client/create" *ngIf="canEdit">
            <span class="button__caption">{{ 'clients.list.create' | translate }}</span>
        </button>
    </div>
    <div class="action-panel__secondary">
        <ng-container *ngIf="viewportBreakpoint === 'desktop'">
            <ng-container [ngTemplateOutlet]="listOptionsTpl"></ng-container>
            <div class="action-panel__item">
                <list-view [(ngModel)]="state.view.desktop" (ngModelChange)="saveState()"></list-view>
            </div>
        </ng-container>
        <div class="action-panel__item">
            <sidebar-trigger [sidebar]="sidebar" [hasMark]="false" (onClick)="sidebar.toggle()"></sidebar-trigger>
        </div>
    </div>
</action-panel>

<sidebar #sidebar [isDesktopActive]="isDesktopSidebarActive" (isDesktopActiveChange)="onSidebarToggle($event)">
    <div class="sidebar__title">&nbsp;</div>
    <div class="sidebar__section" *ngIf="viewportBreakpoint !== 'desktop'">
        <div class="sidebar__label" [canCollapse]="true" [isCollapsed]="state.sidebar.collapse.options" (isCollapsedChange)="onSidebarSectionCollapse('options', $event)">{{ 'sidebar.list_options' | translate }}</div>
        <div class="filters">
            <ng-container [ngTemplateOutlet]="listOptionsTpl"></ng-container>
        </div>
    </div>
    <div class="sidebar__section">
        <div class="sidebar__label" [canCollapse]="true" [isCollapsed]="state.sidebar.collapse.filters" (isCollapsedChange)="onSidebarSectionCollapse('filters', $event)">{{ 'sidebar.filters' | translate }}</div>
        <form [formGroup]="filtersForm" (ngSubmit)="onFiltersSubmit()">
            <div class="filters">
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.name' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="name">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.country' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="country">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.city' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="city">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.tin' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="tin">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.address' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="address">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.email' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="email">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.phone' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="phone">
                </div>
                <div class="filters__filter">
                    <label class="filters__filter-label">{{ 'clients.list.filters.contact' | translate }}</label>
                    <input type="text" class="input input_regular filters__filter-input" formControlName="contact">
                </div>
                <div class="filters__filter">
                    <checkbox formControlName="deleted">{{ 'clients.list.filters.show_removed_clients' | translate }}</checkbox>
                </div>
                <div class="filters__buttons">
                    <button type="button" class="button button_regular button_white" (click)="onFiltersSubmit(true)">
                        <span class="button__caption">{{ 'clients.list.filters.reset__button' | translate }}</span>
                    </button>
                    <button type="submit" class="button button_regular button_blue">
                        <span class="button__caption">{{ 'clients.list.filters.search__button' | translate }}</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</sidebar>

<div class="clients__spinner" *ngIf="listState === 'init' || listState === 'loading'">
    <spinner class="spinner spinner_blue spinner_small"></spinner>
</div>
<div class="clients__message" *ngIf="listState === 'empty'">
    {{ 'clients.list.no_clients' | translate }}
    <a routerLink="/dashboard/client/create" *ngIf="canEdit">{{ 'clients.list.no_clients_2' | translate }}</a>
</div>
<div class="clients__message clients__message_error" *ngIf="listState === 'error'">
    {{ 'clients.list.error' | translate }}
</div>
<div class="clients__list-wrap" [ngClass]="'clients__list-wrap_' + viewType">
    <ng-container *ngIf="listState === 'list' || listState === 'loading-more'">
        <ng-container *ngFor="let clientsPage of clientsPages; let isFirst = first">
            <div class="list-page" *ngIf="!isFirst">{{ 'clients.list.page' | translate }} {{ clientsPage.page + 1 }}</div>
            <div class="items-table-wrap" *ngIf="viewType === 'table'">
                <table class="items-table items-table_clickable">
                    <thead>
                        <tr>
                            <th>{{ 'clients.list.name' | translate }}</th>
                            <th>{{ 'clients.list.legal_name' | translate }}</th>
                            <th>{{ 'clients.list.email' | translate }}</th>
                            <th>{{ 'clients.list.phone' | translate }}</th>
                            <th>{{ 'clients.list.city' | translate }}</th>
                            <th>{{ 'clients.list.country' | translate }}</th>
                            <th>{{ 'clients.list.zip_code' | translate }}</th>
                            <th>{{ 'clients.list.address' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let client of clientsPage.items" [class.clients_deleted]="client.deleted" (click)="goToClient(client)">
                            <td [innerHTML]="client.name || '&nbsp;'"></td>
                            <td>{{ client.legalName }}</td>
                            <td>{{ client.email }}</td>
                            <td>{{ client.phone }}</td>
                            <td>{{ client.city }}</td>
                            <td>{{ client.country }}</td>
                            <td>{{ client.zip }}</td>
                            <td>{{ client.addressLine }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="clients__list" *ngIf="viewType === 'grid-detailed'">
                <div class="clients__list-item" *ngFor="let client of clientsPage.items">
                    <div class="clients__list-item-info">
                        <div class="clients__list-item-name" [class.clients__list-item-name_deleted]="client.deleted">{{ client.name }}</div>
                        <div class="clients__list-item-legal">{{ client.legalName }}</div>
                        <div class="clients__list-item-details">
                            <div class="clients__list-item-col">
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.email' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.email }}</div>
                                </div>
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.phone' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.phone }}</div>
                                </div>
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.city' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.city }}</div>
                                </div>
                            </div>
                            <div class="clients__list-item-col">
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.country' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.country }}</div>
                                </div>
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.zip_code' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.zip }}</div>
                                </div>
                                <div class="clients__list-item-line">
                                    <div class="clients__list-item-label">{{ 'clients.list.address' | translate }}:</div>
                                    <div class="clients__list-item-text">{{ client.addressLine }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clients__list-item-buttons">
                        <button type="button" class="clients__list-item-button" (click)="goToClient(client)">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" height="20" width="20">
                                <path style="fill: currentColor;" d="M14.58,2.83c0.26,0,0.51,0.1,0.71,0.29l1.59,1.59c0.39,0.39,0.39,1.02,0,1.41l-8.51,8.51c-0.51,0.51-1.15,0.88-1.86,1.05l-2.93,0.73l0.73-2.93c0.18-0.7,0.54-1.34,1.05-1.86l8.51-8.51C14.07,2.93,14.33,2.83,14.58,2.83 M14.58,0.83c-0.8,0-1.55,0.31-2.12,0.88l-8.51,8.51c-0.77,0.77-1.31,1.73-1.58,2.79l-0.73,2.93l-0.81,3.23l3.23-0.81l2.93-0.73c1.05-0.26,2.02-0.81,2.79-1.58l8.51-8.51c1.17-1.17,1.17-3.07,0-4.24L16.7,1.71C16.14,1.14,15.38,0.83,14.58,0.83L14.58,0.83z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="clients__list" *ngIf="viewType === 'grid'">
                <div class="clients__list-item" *ngFor="let client of clientsPage.items" (click)="goToClient(client)">
                    <div class="clients__list-item-info">
                        <div class="clients__list-item-name" [class.clients__list-item-name_deleted]="client.deleted">{{ client.name }}</div>
                        <div class="clients__list-item-legal">{{ client.legalName }}</div>
                    </div>
                </div>
            </div>
        </ng-container>
    </ng-container>
    <pagination
        *ngIf="listState === 'list' || listState === 'loading-more'"
        [data]="pagination"
        [isLoading]="listState === 'loading-more'"
        (onLoad)="onSwitchPage($event)"
    ></pagination>
</div>
