<fieldset [disabled]="isSaving">
    <action-panel>
        <div class="action-panel__primary">
            <h1 class="action-panel__header action-panel__header_has-arrow" (click)="goBack()">{{ 'billing.translator_statements.page_header' | translate }}</h1>
        </div>
        <div class="action-panel__secondary" *ngIf="state">
            <div class="action-panel__item">
                <button type="button" class="button button_regular button_blue"
                        [isDisabled]="statementItemsToSave.length === 0"
                        [isProgress]="isSaving"
                        (click)="onSave()"
                >
                    <span class="button__caption">{{ 'billing.translator_statements.save' | translate }}</span>
                </button>
            </div>
            <div class="action-panel__item">
                <sidebar-trigger [sidebar]="sidebar" [hasMark]="false" (onClick)="sidebar.toggle()"></sidebar-trigger>
            </div>
        </div>
    </action-panel>

    <sidebar #sidebar [isDesktopActive]="isDesktopSidebarActive" (isDesktopActiveChange)="onSidebarToggle($event)">
        <div class="sidebar__title">&nbsp;</div>
        <ng-container *ngIf="state">
            <div class="sidebar__section">
                <div class="sidebar__label" [canCollapse]="true" [isCollapsed]="state.sidebar.collapse.filters" (isCollapsedChange)="onSidebarSectionCollapse('filters', $event)">{{ 'sidebar.filters' | translate }}</div>
                <form [formGroup]="filtersForm" (ngSubmit)="onFiltersSubmit()">
                    <div class="filters">
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.translator_name__label' | translate }}</label>
                            <input type="text" class="input input_regular filters__filter-input" formControlName="name">
                        </div>
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.project__label' | translate }}</label>
                            <input type="text" class="input input_regular filters__filter-input" formControlName="project">
                        </div>
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.project_status__label' | translate }}</label>
                            <select class="select select_regular filters__filter-input" formControlName="status">
                                <option *ngFor="let statusOption of projectStatusOptions" [ngValue]="statusOption.value" [innerHTML]="statusOption.display | translate"></option>
                            </select>
                        </div>
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.project_created_since__label' | translate }}</label>
                            <datepicker class="filters__filter-input" [format]="selectDateFormat" formControlName="from"></datepicker>
                        </div>
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.project_completed_before__label' | translate }}</label>
                            <datepicker class="filters__filter-input" [format]="selectDateFormat" formControlName="to"></datepicker>
                        </div>
                        <div class="filters__filter">
                            <label class="filters__filter-label">{{ 'billing.translator_statements.filters.comment__label' | translate }}</label>
                            <input type="text" class="input input_regular filters__filter-input" formControlName="comment">
                        </div>
                        <div class="filters__buttons">
                            <button type="button" class="button button_regular button_white" (click)="onFiltersSubmit(true)">
                                <span class="button__caption">{{ 'billing.translator_statements.filters.reset__button' | translate }}</span>
                            </button>
                            <button type="submit" class="button button_regular button_blue">
                                <span class="button__caption">{{ 'billing.translator_statements.filters.search__button' | translate }}</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </ng-container>
    </sidebar>

    <div class="translator-statements__spinner" *ngIf="listState === 'init' || listState === 'loading'">
        <spinner class="spinner spinner_blue spinner_small"></spinner>
    </div>
    <div class="translator-statements__message" *ngIf="listState === 'empty'">
        {{ 'billing.translator_statements.no_statements' | translate }}
    </div>
    <div class="translator-statements__message translator-statements__message_error" *ngIf="listState === 'error'">
        {{ 'billing.translator_statements.error' | translate }}
    </div>
    <ng-container *ngIf="listState === 'list' || listState === 'loading-more'" [ngSwitch]="viewportBreakpoint === 'desktop'">
        <ng-container *ngSwitchCase="true">
            <div class="translator-statements__table-wrap">
                <ng-container *ngFor="let statementsPage of statementsPages; let isFirst = first">
                    <div class="coordinator-statements__list-page" *ngIf="!isFirst">{{ 'pagination.page' | translate }} {{ statementsPage.page + 1 }}</div>
                    <table class="translator-statements__table">
                        <tbody>
                            <ng-container *ngFor="let statement of statementsPage.items; trackBy: statementsTrackBy">
                                <tr>
                                    <td colspan="6" class="translator-statements__table-name">{{ statement.lastName }} {{ statement.firstName }}</td>
                                </tr>
                                <tr>
                                    <th>{{ 'billing.translator_statements.project' | translate }}</th>
                                    <th>{{ 'billing.translator_statements.status' | translate }}</th>
                                    <th>{{ 'billing.translator_statements.amount' | translate }}</th>
                                    <th>{{ 'billing.translator_statements.payment_id' | translate }}</th>
                                    <th>{{ 'billing.translator_statements.paid' | translate }}</th>
                                    <th>{{ 'billing.translator_statements.comment' | translate }}</th>
                                </tr>
                                <tr *ngFor="let item of statement.items; trackBy: statementItemsTrackBy">
                                    <td>{{ item.projectKey }}</td>
                                    <td>{{ ('projects.statuses.' + item.projectStatusKey) | translate }}</td>
                                    <td>{{ item.fee / 100 | number : '.2-2' }}</td>
                                    <td>{{ item.translatorDebitId || ' ' }}</td>
                                    <td>
                                        <checkbox [(ngModel)]="item.debited" (ngModelChange)="onChangeItem(item)"></checkbox>
                                    </td>
                                    <td class="translator-statements__table-cell translator-statements__table-cell_has-input">
                                        <textarea class="translator-statements__table-textarea" #textarea [style.height.px]="textarea.scrollHeight" [(ngModel)]="item.comment" (ngModelChange)="onChangeItem(item)"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <th colspan="2" class="text-right">{{ 'billing.translator_statements.total_amount' | translate }}:</th>
                                    <th>{{ statement.total / 100 | number : '.2-2' }}</th>
                                    <th colspan="3">&nbsp;</th>
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>
                </ng-container>
            </div>
            <div class="translator-statements__pagination">
                <pagination
                    [data]="pagination"
                    [isLoading]="listState === 'loading-more'"
                    (onLoad)="onSwitchPage($event)"
                ></pagination>
            </div>
        </ng-container>
        <ng-container *ngSwitchCase="false">
            <div class="translator-statements__list">
                <ng-container *ngFor="let statementsPage of statementsPages; let isFirst = first">
                    <div class="coordinator-statements__list-page" *ngIf="!isFirst">{{ 'pagination.page' | translate }} {{ statementsPage.page + 1 }}</div>
                    <div class="translator-statements__list-statement" *ngFor="let statement of statementsPage.items; trackBy: statementsTrackBy">
                        <div class="translator-statements__list-statement-header">
                            <div class="translator-statements__list-statement-name1">{{ statement.lastName }} {{ statement.firstName }}</div>
                        </div>
                        <div class="translator-statements__list-statement-item" *ngFor="let item of statement.items; trackBy: statementItemsTrackBy">
                            <table class="translator-statements__list-statement-table">
                                <tbody>
                                <tr>
                                    <th>{{ 'billing.translator_statements.project' | translate }}:</th>
                                    <td>{{ item.projectKey }}</td>
                                </tr>
                                <tr>
                                    <th>{{ 'billing.translator_statements.status' | translate }}:</th>
                                    <td>{{ ('projects.statuses.' + item.projectStatusKey) | translate }}</td>
                                </tr>
                                <tr>
                                    <th>{{ 'billing.translator_statements.amount' | translate }}:</th>
                                    <td>{{ item.fee / 100 | number : '.2-2' }}</td>
                                </tr>
                                <tr>
                                    <th>{{ 'billing.translator_statements.payment_id' | translate }}:</th>
                                    <td>{{ item.translatorDebitId }}</td>
                                </tr>
                                <tr>
                                    <th class="translator-statements__list-statement-table-checkbox-label">{{ 'billing.translator_statements.paid' | translate }}:</th>
                                    <td><checkbox [(ngModel)]="item.debited" (ngModelChange)="onChangeItem(item)"></checkbox></td>
                                </tr>
                                <tr>
                                    <th class="translator-statements__list-statement-table-input-label">{{ 'billing.translator_statements.comment' | translate }}:</th>
                                    <td><input type="text" class="input input_regular translator-statements__list-statement-table-input" [(ngModel)]="item.comment" (ngModelChange)="onChangeItem(item)"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="translator-statements__list-statement-total">
                            <table class="translator-statements__list-statement-total-table">
                                <tbody>
                                    <tr>
                                        <th>
                                            {{ 'billing.translator_statements.total_amount' | translate }}:
                                        </th>
                                        <td>
                                            {{ statement.total / 100 | number : '.2-2' }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </ng-container>
            </div>
            <pagination
                [data]="pagination"
                [isLoading]="listState === 'loading-more'"
                (onLoad)="onSwitchPage($event)"
            ></pagination>
        </ng-container>
    </ng-container>
</fieldset>

