<fieldset [disabled]="isSaving || isDeleting">
    <action-panel>
        <div class="action-panel__primary">
            <h1 class="action-panel__header action-panel__header_has-arrow" (click)="goBack()">{{ 'settings.taxes.page_header' | translate }}</h1>
            <button class="button button_regular button_green" (click)="onCreate()" [disabled]="listState === 'loading' || listState === 'error'">
                <span class="button__caption">{{ 'settings.taxes.add' | translate }}</span>
            </button>
        </div>
        <div class="action-panel__secondary">
            <div class="action-panel__item">
                <sort-select [(ngModel)]="state.sort" [options]="sortOptions" (ngModelChange)="onOrderChange()" [isDisabled]="listState === 'loading' || listState === 'error'"></sort-select>
            </div>
        </div>
    </action-panel>

    <ng-container [ngSwitch]="listState">
        <div class="taxes-editor__spinner" *ngSwitchCase="'loading'">
            <spinner class="spinner spinner_blue spinner_small"></spinner>
        </div>
        <div class="taxes-editor__message" *ngSwitchCase="'empty'">
            {{ 'settings.taxes.no_taxes' | translate }}
            <span class="pseudo-link" (click)="onCreate()">{{ 'settings.taxes.no_taxes_2' | translate }}</span>
        </div>
        <div class="taxes-editor__message taxes-editor__message_error" *ngSwitchCase="'error'">
            {{ 'settings.taxes.unknown_error' | translate }}
        </div>
        <ng-container *ngSwitchCase="'list'" [ngSwitch]="viewportBreakpoint">
            <div class="items-table-wrap taxes-editor__table-wrap" *ngSwitchCase="'desktop'">
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>{{ 'settings.taxes.name' | translate }}</th>
                            <th class="taxes-editor__table-cell-number">{{ 'settings.taxes.tax' | translate }}</th>
                            <th class="table-cell-tight">&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let tax of taxes">
                            <td>{{ tax.name }}</td>
                            <td class="taxes-editor__table-cell-number">{{ tax.value / 10000 | number : '.4-4' }}</td>
                            <td class="table-cell-tight table-cell-no-padding">
                                <button type="button" class="taxes-editor__table-button" (click)="onDelete(tax)"></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="taxes-editor__list" *ngSwitchDefault>
                <div class="taxes-editor__list-item" *ngFor="let tax of taxes">
                    <div class="taxes-editor__list-item-header">
                        <div class="taxes-editor__list-item-name">{{ tax.name }}</div>
                        <button type="button" class="taxes-editor__list-item-button" (click)="onDelete(tax)"></button>
                    </div>
                    <div class="taxes-editor__list-item-info">
                        <table class="taxes-editor__list-item-info-table">
                            <tbody>
                                <tr>
                                    <th>{{ 'settings.taxes.tax' | translate }}:</th>
                                    <td>{{ tax.value / 10000 | number : '.4-4' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </ng-container>
    </ng-container>

    <popup-custom #editor [options]="{ closeBy: 'manual' }" class="taxes-editor__editor" (onCloseRequest)="onHideEditor($event)" *ngIf="taxToEdit">
        <popup-box>
            <popup-header>{{ 'settings.taxes.page_header' | translate }}</popup-header>
            <popup-content>
                <!-- Content -->
                <div class="taxes-editor__editor-content">
                    <div class="taxes-editor__controls">
                        <div class="taxes-editor__control">
                            <label class="taxes-editor__control-label">
                                <span class="taxes-editor__control-label-text">
                                    {{ 'settings.taxes.name' | translate }}
                                </span>
                            </label>
                            <input type="text" class="input input_regular taxes-editor__control-input" [(ngModel)]="taxToEdit.name" (ngModelChange)="validate()" required>
                        </div>
                        <div class="taxes-editor__control">
                            <label class="taxes-editor__control-label">
                                <span class="taxes-editor__control-label-text">
                                    {{ 'settings.taxes.tax' | translate }}
                                </span>
                            </label>
                            <input type="text" class="input input_regular taxes-editor__control-input"
                                number-mask
                                [disabled]="isSaving"
                                [(numberModel)]="taxToEdit.value"
                                [numberModelOptions]="{
                                    updateOn: 'change',
                                    defaultValue: 0,
                                    type: 'number',
                                    viewFraction: 10000,
                                    min: 0,
                                    max: 1000000,
                                    allowZero: true,
                                    sign: '+',
                                    delimiter: ','
                                }"
                                (numberModelChange)="validate()"
                                required>
                        </div>
                    </div>
                </div>
                <!-- /Content -->
            </popup-content>
            <popup-controls>
                <div class="popup__controls-buttons">
                    <button type="button" class="button button_regular button_white" (click)="onHideEditor()">
                        <span class="button__caption">{{ 'settings.taxes.back' | translate }}</span>
                    </button>
                    <button type="button" class="button button_regular button_blue" (click)="onSave()" [isDisabled]="!isEditorFormValid" [isProgress]="isSaving">
                        <span class="button__caption">{{ 'settings.taxes.add' | translate }}</span>
                    </button>
                </div>
            </popup-controls>
        </popup-box>
    </popup-custom>
</fieldset>
